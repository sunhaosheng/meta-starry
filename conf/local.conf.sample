# StarryOS Yocto 构建本地配置模板
#
# 使用方法:
#   1. source poky/oe-init-build-env build
#   2. 将此文件复制到 build/conf/local.conf
#   或者设置 TEMPLATECONF 指向 meta-starry/conf

# ==================== 机器选择 ====================
# 可选值:
#   aarch64-qemu-virt      - ARM64 QEMU (默认)
#   riscv64-qemu-virt      - RISC-V 64 QEMU
#   loongarch64-qemu-virt  - LoongArch64 QEMU
#   x86_64-qemu-q35        - x86_64 QEMU
MACHINE = "aarch64-qemu-virt"

# ==================== 发行版 ====================
DISTRO = "starryos"

# ==================== Rust 工具链 ====================
# 默认使用 rustup 预编译的 nightly 工具链（通过 rust-prebuilt-native）
# 要求：系统已安装 rustup 和 nightly 工具链
# 
# 安装方法：
#   rustup toolchain install nightly
#   rustup target add aarch64-unknown-none-softfloat --toolchain nightly
#   rustup target add riscv64gc-unknown-none-elf --toolchain nightly
#   rustup target add loongarch64-unknown-none-softfloat --toolchain nightly
#   rustup target add x86_64-unknown-none --toolchain nightly
#
# 注意：必须使用 nightly，因为 StarryOS 需要 unstable features

# ==================== ArceOS 构建参数 ====================
# 取消注释以覆盖默认值

# CPU 核心数 (默认: 4)
#ARCEOS_SMP = "8"

# 日志级别: off/error/warn/info/debug/trace (默认: warn)
#ARCEOS_LOG = "debug"

# 内存大小 (默认: 由平台配置决定)
#ARCEOS_MEM = "2G"

# 调试信息: y/n (默认: y)
#ARCEOS_DWARF = "y"

# ==================== 并行构建 ====================
# 根据你的 CPU 核心数调整
BB_NUMBER_THREADS = "30"
PARALLEL_MAKE = "-j 30"

# ==================== 下载与缓存目录 ====================
# 可选：使用共享目录加速多次构建
#DL_DIR = "${TOPDIR}/../downloads"
#SSTATE_DIR = "${TOPDIR}/../sstate-cache"

# ==================== 磁盘空间监控 ====================
BB_DISKMON_DIRS ??= "\
    STOPTASKS,${TMPDIR},1G,100K \
    STOPTASKS,${DL_DIR},1G,100K \
    STOPTASKS,${SSTATE_DIR},1G,100K \
    STOPTASKS,/tmp,100M,100K \
    HALT,${TMPDIR},100M,1K \
    HALT,${DL_DIR},100M,1K \
    HALT,${SSTATE_DIR},100M,1K \
    HALT,/tmp,10M,1K"

# ==================== 构建选项 ====================
# 禁用交互式补丁解决
PATCHRESOLVE = "noop"

# 版本标识
CONF_VERSION = "2"
