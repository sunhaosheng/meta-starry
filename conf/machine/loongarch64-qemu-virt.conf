#@TYPE: Machine
#@NAME: loongarch64-qemu-virt
#@DESCRIPTION: LoongArch 64-bit QEMU virt machine for StarryOS/ArceOS

# 基础架构配置
require conf/machine/include/loongarch/tune-loongarch.inc
require conf/machine/include/qemu.inc

# ArceOS 通用配置
require conf/machine/include/arceos-machine-common.inc

# ==================== ArceOS/StarryOS 必须变量 ====================
# 对应 Makefile: ARCH, PLAT_NAME, MYPLAT, TARGET
ARCEOS_ARCH = "loongarch64"
ARCEOS_PLATFORM = "loongarch64-qemu-virt"
ARCEOS_PLAT_PACKAGE = "axplat-loongarch64-qemu-virt"
RUST_TARGET = "loongarch64-unknown-none-softfloat"

# ==================== LoongArch64 架构配置 ====================
TUNE_PKGARCH = "loongarch64"
PACKAGE_EXTRA_ARCHS = "loongarch64"
KERNEL_ARCH = "loongarch"

# ==================== 平台默认值 ====================
ARCEOS_SMP ?= "4"

# ==================== QEMU 配置 ====================
QB_SYSTEM_NAME = "qemu-system-loongarch64"
QB_MACHINE = "-machine virt"
QB_CPU = "-cpu la464"
QB_SMP = "-smp ${ARCEOS_SMP}"
QB_MEM = "-m 2048"
QB_NETWORK_DEVICE = "-device virtio-net-pci,netdev=net0,mac=@MAC@"
QB_KERNEL_CMDLINE_APPEND = "console=ttyS0"

SERIAL_CONSOLES = "115200;ttyS0"
