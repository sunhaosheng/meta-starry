# starryos.conf
# StarryOS 发行版配置
#
# 设计原则：
# - 集中管理工具链版本 (Rust nightly)
# - 提供 ArceOS 构建系统默认配置
# - 保持配方专注于构建单个组件
#
# 对应关系:
#   StarryOS/Makefile 的 export 变量 -> arceos-defaults.inc
#   Rust 工具链版本 -> starry-rust-toolchain.inc

DISTRO_NAME = "starryos"
DISTRO_VERSION = "2.0"

# ==================== Rust 工具链选择 ====================
# 使用预编译的 nightly 工具链（rust-prebuilt-native）
# 优点：快速、包含所有 unstable features、构建可重现
PREFERRED_PROVIDER_rust-native = "rust-prebuilt-native"
PREFERRED_PROVIDER_cargo-native = "rust-prebuilt-native"

# ==================== 引入配置文件 ====================
require conf/distro/include/arceos-defaults.inc

# Bare-metal kernel - no package management needed
# Set to ipk to satisfy image.bbclass parsing, but won't be used
PACKAGE_CLASSES = "package_ipk"

# Skip package installation for bare-metal builds
INHIBIT_PACKAGE_INSTALL = "1"
INHIBIT_PACKAGE_STRIP = "1"

# Bare-metal doesn't need C++ runtime libraries or libc
# gcc-runtime provides libstdc++, which requires dynamic linking
ASSUME_PROVIDED += "libgcc-dev libgcc virtual/${TARGET_PREFIX}compilerlibs"
PREFERRED_PROVIDER_virtual/${TARGET_PREFIX}compilerlibs = "gcc-cross-${TARGET_ARCH}"

# Remove virtual/libc from BASEDEPENDS to prevent gcc-runtime dependency
# tclibc-baremetal.inc already puts virtual/libc in ASSUME_PROVIDED
# but base.bbclass still includes it in BASE_DEFAULT_DEPS
BASEDEPENDS:remove:class-target = "virtual/libc"

# Use rust-prebuilt-native instead of building from source
# Mask poky's Rust recipes to avoid conflicts
BBMASK += "poky/meta/recipes-devtools/rust/"
BBMASK += "poky/meta/recipes-devtools/cargo/"

# Pin rust std version to 1.92.0 to silence preferred-version warnings
PREFERRED_VERSION_libstd-rs = "1.92.0"
PREFERRED_VERSION_libstd-rs-dev = "1.92.0"

# StarryOS is #![no_std] kernel - does NOT need libstd-rs target library
# Force RUSTLIB_DEP to empty to override poky's rust-common.bbclass default
# Note: This must be set here in distro conf to take effect before classes load
RUSTLIB_DEP = ""
